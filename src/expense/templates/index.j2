<!doctype html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Expense</title>
  <link rel="stylesheet" href="/static/style.css?v={{ range(100000, 999999) | random }}" />
  <link rel="manifest" href="/static/manifest.json" />
  <meta name="theme-color" content="#111827">
  <script src="/static/preload.js?v={{ range(100000, 999999) | random }}"></script>
</head>

<body>
  <button id="install-btn" class="btn install" style="display: none;"> {{ icons.get("pwa_install", "ğŸ“²") }} ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</button>
  <button id="hamburger-menu-btn" class="small-btn"> {{ icons.get("hamburger_menu", "â˜°") }} </button>
  <div id="menu-container">
    <form method="get" action="/"><button type="submit" id="home-btn" class="small-btn"> {{ icons.get("home", "ğŸ ") }} ãƒ›ãƒ¼ãƒ ã€€ </button></form>
    <form method="get" action="/asset_management"><button type="submit" id="asset-management-btn" class="small-btn"> {{ icons.get("asset_management", "ğŸ“ˆ") }} è³‡ç”£ç®¡ç† </button></form>
    <button id="theme-toggle" class="small-btn"> {% if theme == "dark" %} {{ icons.get("light_theme", "â˜€ï¸") }} {% else %} {{ icons.get("dark_theme", "ğŸŒ™") }} {% endif %} ãƒ†ãƒ¼ãƒã€€ </button>
  </div>
  <div class="container">
    <h1> {{ icons.get("title", "") }} Expense </h1>

    {% if status and msg %}
    <div class="success">
      {{ msg }}
    {% if info %}
      <p><strong> {{ info }} </strong></p>
    {% endif %}
    </div>
    {% elif not status and msg %}
    <div class="failed">
      {{ msg }}
    {% if info %}
      <p><strong> {{ info }} </strong></p>
    {% endif %}
    </div>
    {% endif %}

    <div class="card">
      <form method="post" action="/register">
        <h3 class="collapsible-trigger" data-key="register">
          <span> {{ icons.get("register", "ğŸš€") }} å®¶è¨ˆç°¿ã«ç™»éŒ²ã™ã‚‹æƒ…å ±ã‚’å…¥åŠ› </span>
          <span class="collapsible-toggle"></span>
        </h3>
        <div id="register-container" class="collapsible-content">
          <input
            type="date"
            id="expense-date"
            name="expense_date"
            value="{{ expense_date or today }}"
            min="{{ expense_date_range[0] }}"
            max="{{ expense_date_range[1] }}"
            required
          />
          <select id="expense-type" name="expense_type">
            {% for item in items %}
            <option value="{{ item }}">
              {{ item }}
            </option>
            {% endfor %}
          </select>
          <input type="number" id="expense-amount" name="expense_amount" value=""
            placeholder="{{ icons.get('input_amount', 'ğŸ’´') }} é‡‘é¡ã‚’å…¥åŠ›" {% if items | length and "/" in items[0] %} style="display: none;" {% else %} required
            {% endif %} />
          <input type="text" id="expense-memo" name="expense_memo" value="" placeholder="{{ icons.get('input_memo', 'âœï¸') }} ãƒ¡ãƒ¢ã‚’å…¥åŠ›"
            {% if items | length and "/" in items[0] %} style="display: none;" {% endif %} />
          <button type="submit" class="btn">ï¼‹ ç™»éŒ²</button>
        </div>
      </form>
    </div>

    {% if screenshot_name %}
    <div class="card">
      <form method="post" action="/ocr">
        <h3 class="collapsible-trigger" data-key="ocr">
          <span> {{ icons.get("ocr", "ğŸ“·") }} QRæ±ºæ¸ˆã®ç”»åƒã‹ã‚‰æ”¯æ‰•æƒ…å ±ã‚’å–å¾— </span>
          <span class="collapsible-toggle"></span>
        </h3>
        <div id="ocr-container" class="collapsible-content">
          <div id="screenshot-name">
            {{ icons.get("screenshot_name", "") }} å¯¾è±¡ç”»åƒ : {{ screenshot_name.split("/") | last }}
          </div>
          <div id="img-overlay" class="overlay"></div>
          <img id="screenshot" class="screenshot" alt="{{ screenshot_name.split(" /") | last }}"
            src="data:image/png;base64,{{ screenshot_base64 }}"
            onclick="this.classList.toggle('is-zoomed')"
          >
          <button type="submit" class="btn secondary" {% if disable_ocr %} disabled {% endif %}> {% if disable_ocr %} ç™»éŒ²æ¸ˆ
            {% else %} èª­å–å®Ÿè¡Œ {% endif %}</button>
        </div>
      </form>
    </div>
    {% endif %}

    <div class="card">
      <h3 class="collapsible-trigger" data-key="record">
        <span> {{ icons.get("record_table", "ğŸ§¾") }} ç›´è¿‘ã®æ”¯å‡ºå±¥æ­´ ({{n_records}}ä»¶) </span>
        <span class="collapsible-toggle"></span>
      </h3>
      <div id="confirmation-overlay" class="overlay" style="display: none;">
        <div id="confirmation-dialog" class="confirm">
          <h3> {{ icons.get("confirm_dialog", "ğŸ› ï¸") }}  ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ç·¨é›† </h3>
          <button id="confirmation-close-btn" type="button" class="btn-close"> âœ• </button>
          <div class="confirmation-btn-container">
            <form method="post" action="/edit">
              <input type="hidden" id="target-record-date" name="target_date">
              <input type="hidden" id="target-record-type" name="target_type">
              <input type="hidden" id="target-record-amount" name="target_amount">
              <input type="hidden" id="target-record-memo" name="target_memo">
              <input
                type="date"
                id="new-expense-date"
                name="new_expense_date"
                min="{{ expense_date_range[0] }}"
                max="{{ expense_date_range[1] }}"
                required
              />
              <select id="new-expense-type" name="new_expense_type">
                {% for item in items %}
                {% if "/" not in item %}
                <option value="{{ item }}">
                  {{ item }}
                </option>
                {% endif %}
                {% endfor %}
              </select>
              <input type="text" id="new-expense-amount" name="new_expense_amount" placeholder="{{ icons.get('input_amount', 'ğŸ’´') }} é‡‘é¡ã‚’å…¥åŠ›" required>
              <input type="text" id="new-expense-memo" name="new_expense_memo" placeholder="{{ icons.get('input_memo', 'âœï¸') }} ãƒ¡ãƒ¢ã‚’å…¥åŠ›">
              <div class="space"></div>
              <button type="submit" class="btn-edit"> {{ icons.get("edit_record", "ğŸ”§") }} ä¿®æ­£ </button>
            </form>
            <form method="post" action="/delete">
              <input type="hidden" name="expense_date" id="delete-record-date">
              <input type="hidden" name="expense_type" id="delete-record-type">
              <input type="hidden" name="expense_amount" id="delete-record-amount">
              <input type="hidden" name="expense_memo" id="delete-record-memo">
              <button type="submit" class="btn-delete"> {{ icons.get("delete_record", "ğŸ—‘ï¸") }} å‰Šé™¤ </button>
            </form>
          </div>
        </div>
      </div>
      <a href="{{ gspread_url }}" class="link-spread"> {{ icons.get("link", "ğŸ”—") }} ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã </a>
      <div id="record-container" class="collapsible-content">
        <div class="search-wrapper">
          <input type="text" id="search-input" placeholder="{{ icons.get('search', 'ğŸ”') }} å±¥æ­´ã‚’æ¤œç´¢" onkeyup="filterTable()" />
          <button id="clear-search" type="button">âœ•</button>
        </div>
        <div class="table-container">
          <table>
            <colgroup>
              <col>
              <col>
              <col>
              <col>
            </colgroup>
            <thead>
              <tr>
                <th>æ—¥ä»˜</th>
                <th>ã‚«ãƒ†ã‚´ãƒª</th>
                <th>é‡‘é¡</th>
                <th>ãƒ¡ãƒ¢</th>
              </tr>
            </thead>
            <tbody>
              {% for record in records %}
              <tr>
                <td>{{ record.date }}</td>
                <td>{{ record.expense_type }}</td>
                <td>Â¥{{ "{:,}".format(record.expense_amount) }}</td>
                <td class="memo">{{ record.expense_memo }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div id="total-amount" style="display: none"></div>
      </div>
    </div>

    <div class="card">
      <h3 class="collapsible-trigger" data-key="report">
        <span> {{ icons.get("report", "ğŸ“Š") }} æ”¯å‡ºãƒ¬ãƒãƒ¼ãƒˆ ({{today}}) </span>
        <span class="collapsible-toggle"></span>
      </h3>
      <div id="report-container" class="collapsible-content">
        <div class="summary-list">
          <li> æœ¬æ—¥ã®æ”¯å‡ºé‡‘é¡ : Â¥{{ "{:,}".format(today_total) }} </li>
          <li> ä»Šæœˆã®æ”¯å‡ºé‡‘é¡ : Â¥{{ "{:,}".format(monthly_total) }} </li>
          <li> å‰æœˆã®æ”¯å‡ºé‡‘é¡ : Â¥{{ "{:,}".format(prev_monthly_total) }} </li>
        </div>
        {% if graph_html %}
          <div class="graph-container">
            <hr>
            {{ graph_html | safe }}
          </div>
        {% endif %}
      </div>
    </div>

  </div>
  <div id="loader" class="overlay" style="display: none;">
    <div class="spinner"></div>
  </div>
</body>
<script src="/static/main.js?v={{ range(100000, 999999) | random }}"></script>

</html>
