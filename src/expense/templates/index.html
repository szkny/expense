<!doctype html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Expense</title>
  <script> if (localStorage.getItem('theme') === 'dark') document.documentElement.classList.add('dark'); </script>
  <link rel="stylesheet" href="/static/style.css?v={{ range(100000, 999999) | random }}" />
  <link rel="manifest" href="/static/manifest.json" />
  <meta name="theme-color" content="#111827">
</head>

<body>
  <button id="theme-toggle" class="theme-toggle"> {% if theme == "dark" %}â˜€ï¸{% else %}ğŸŒ™{% endif %} </button>
  <button id="install-btn" class="btn install" style="display: none;">ğŸ“² ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</button>
  <div class="container">
    <h1>ğŸ“ Expense </h1>
    <p>å®¶è¨ˆç°¿ã«ç™»éŒ²ã™ã‚‹æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>

    <div class="card">
      <form method="post" action="/register">
        <h3>ğŸš€ æ”¯å‡ºã‚¿ã‚¤ãƒ—</h3>
        <select id="expense-type" name="expense_type">
          {% for item in items %}
          <option value="{{ item }}" {% if selected_type and selected_type==item %} selected {% endif %}>
            {{ item }}
          </option>
          {% endfor %}
        </select>

        <input type="number" id="expense-amount" name="expense_amount" value="{{ expense_amount or '' }}"
          placeholder="ğŸ’´ é‡‘é¡ã‚’å…¥åŠ›" {% if items | length and "/" in items[0] %} style="display: none;" {% else %} required
          {% endif %} />

        <input type="text" id="expense-memo" name="expense_memo" value="{{ expense_memo or '' }}" placeholder="âœï¸ ãƒ¡ãƒ¢ã‚’å…¥åŠ›"
          {% if items | length and "/" in items[0] %} style="display: none;" {% endif %} />

        <button type="submit" class="btn">ï¼‹ ç™»éŒ²</button>
      </form>
    </div>

    {% if screenshot_name %}
    <div class="card">
      <form method="post" action="/ocr">
        <h3> ğŸ“·ï¸ æ±ºæ¸ˆã‚¢ãƒ—ãƒªã®ã‚¹ã‚¯ã‚·ãƒ§ã‹ã‚‰æ”¯æ‰•æƒ…å ±ã‚’å–å¾— </h3>
        <p style="font-size: 0.8rem;margin-left: 10px">
          â–¶ï¸ å¯¾è±¡ç”»åƒ : {{ screenshot_name.split("/") | last }}
        </p>
        <img class="screenshot" alt="{{ screenshot_name.split(" /") | last }}"
          src="data:image/png;base64,{{ screenshot_base64 }}"
          onclick="this.classList.toggle('is-zoomed')"
        >
        <button type="submit" class="btn secondary" {% if disable_ocr %} disabled {% endif %}> {% if disable_ocr %} ç™»éŒ²æ¸ˆ
          {% else %} èª­å–å®Ÿè¡Œ {% endif %}</button>
      </form>
    </div>
    {% endif %}

    {% if selected_type and input_amount %}
    <div class="success">
      âœ… å®¶è¨ˆç°¿ã¸ã®ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸã€‚
      <p><strong>{{ selected_type }}: {{ input_memo + ", " if input_memo else "" }}Â¥{{ "{:,}".format(input_amount)}}</strong></p>
    </div>
    {% endif %}

    <div class="card">
      <h3 id="report-section">
        <span> ğŸ“Š æ”¯å‡ºãƒ¬ãƒãƒ¼ãƒˆ ({{today}}) </span>
        <span id="report-toggle"> â–¼ </span>
      </h3>
      <div id="report-container">
        <div class="summary-list">
          <li> æœ¬æ—¥ã®æ”¯å‡ºé‡‘é¡ : Â¥{{ "{:,}".format(today_total) }} </li>
          <li> ä»Šæœˆã®æ”¯å‡ºé‡‘é¡ : Â¥{{ "{:,}".format(monthly_total) }} </li>
          <li> å‰æœˆã®æ”¯å‡ºé‡‘é¡ : Â¥{{ "{:,}".format(prev_monthly_total) }} </li>
        </div>
        {% if graph_html %}
          <div class="graph-container">
            <hr>
            {{ graph_html | safe }}
          </div>
        {% endif %}
      </div>
    </div>

    <div class="card">
      <h3 id="table-section">
        <span> ğŸ§¾ ç›´è¿‘ã®æ”¯å‡ºå±¥æ­´ ({{n_records}}ä»¶) </span>
        <span id="table-toggle"> â–¼ </span>
      </h3>
      <a href="{{ gspread_url }}" class="link-spread"> ğŸ”— ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã </a>
      <div id="records-container" class="table-container">
        <div class="search-wrapper">
          <input type="text" id="search-input" placeholder="ğŸ”ï¸ æ”¯å‡ºã‚¿ã‚¤ãƒ— or ãƒ¡ãƒ¢ã§æ¤œç´¢" onkeyup="filterTable()" />
          <button id="clear-search" type="button">âœ•</button>
        </div>
        <table>
          <thead>
            <tr>
              <th>æ—¥ä»˜</th>
              <th>æ”¯å‡ºã‚¿ã‚¤ãƒ—</th>
              <th>é‡‘é¡</th>
              <th class="memo">ãƒ¡ãƒ¢</th>
            </tr>
          </thead>
          <tbody>
            {% for record in records %}
            <tr>
              <td>{{ record.date }}</td>
              <td>{{ record.expense_type }}</td>
              <td>Â¥{{ "{:,}".format(record.expense_amount) }}</td>
              <td class="memo">{{ record.expense_memo }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <div id="total-amount" style="margin-top: 8px; font-weight: bold; text-align: right;" hidden></div>
      </div>
    </div>
  </div>
  <div id="loader" class="loader-overlay" style="display: none;">
    <div class="spinner"></div>
  </div>
</body>
<script src="/static/main.js?v={{ range(100000, 999999) | random }}"></script>

</html>
