<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Expense</title>
    <link rel="stylesheet" href="/static/style.css" />
    <link rel="manifest" href="/static/manifest.json" />
  </head>
  <body>
    <div class="container">
      <h1>📝 Expense </h1>
      <p>家計簿に登録する情報を入力してください</p>

      <div class="card">
        <form method="post" action="/register">
          <label for="expense-type">支出タイプ</label>
          <select id="expense-type" name="expense_type">
            {% for item in items %}
              <option
                value="{{ item }}"
                {% if selected_type and selected_type == item %}
                  selected
                {% endif %}
              >
                {{ item }}
              </option>
            {% endfor %}
          </select>

          <input
            type="number"
            id="expense-amount"
            name="expense_amount"
            value="{{ expense_amount or '' }}"
            placeholder="💴 金額を入力"
            {% if items | length and "/" in items[0] %}
              style="display: none;"
            {% else %}
              required
            {% endif %}
          />

          <input
            type="text"
            id="expense-memo"
            name="expense_memo"
            value="{{ expense_memo or '' }}"
            placeholder="📝 メモを入力"
            {% if items | length and "/" in items[0] %}
              style="display: none;"
            {% endif %}
          />

          <button type="submit" class="btn">＋ 登録</button>
        </form>
      </div>

      <div class="card">
        <form method="post" action="/ocr">
          <p>📷️ 決済アプリ画面のスクショから支払情報を取得</p>
          <button type="submit" class="btn secondary">OCR 実行</button>
        </form>
      </div>

      {% if selected_type and input_amount %}
        <div class="success">
          ✅ 家計簿への登録が完了しました。
          <p><strong>{{ selected_type }}: {{ input_memo + ", " if input_memo else "" }}¥{{ "{:,}".format(input_amount) }}</strong></p>
        </div>
      {% endif %}

      <h2>📊 直近の支払履歴</h2>
      <div class="table-container">
        <table>
          <tr>
            <th>日付</th>
            <th>支出タイプ</th>
            <th>金額</th>
            <th>メモ</th>
          </tr>
          {% for record in records %}
            <tr>
              <td>{{ record.date }}</td>
              <td>{{ record.expense_type }}</td>
              <td>¥{{ "{:,}".format(record.expense_amount) }}</td>
              <td>{{ record.expense_memo }}</td>
            </tr>
          {% endfor %}
        </table>
      </div>
    </div>

    <script>
      const typeSelect = document.getElementById("expense-type");
      const amountInput = document.getElementById("expense-amount");
      const memoInput = document.getElementById("expense-memo");
      typeSelect.addEventListener("change", function () {
        if (this.value.includes("/")) {
          amountInput.style.display = "none";
          memoInput.style.display = "none";
          amountInput.required = false;
        } else {
          amountInput.style.display = "block";
          memoInput.style.display = "block";
          amountInput.required = true;
        }
      });
    </script>
  </body>
</html>
